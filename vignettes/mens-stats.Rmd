---
title: "AFL Mens Example"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{AFL Mens Example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r setup, include = FALSE}
not_cran = identical(Sys.getenv("NOT_CRAN"), "true")
online <- !is.null(curl::nslookup("r-project.org", error = FALSE))
eval_param <- not_cran & online


knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = eval_param
)
original_options <- options()
options(tibble.print_min = 5, tibble.print_max = 5)
requireNamespace("ggplot2", quietly = TRUE)

results <- fitzRoy:::results
fixture <- fitzRoy:::fixture
stats <- fitzRoy:::stats
stats_gf <- fitzRoy:::stats_gf
ladder <- fitzRoy:::ladder
ladder_round <- fitzRoy:::ladder_round
sources <- fitzRoy:::sources
tips <- fitzRoy:::tips
tips_round <- fitzRoy:::tips_round

```

## Overview
The goal of fitzRoy is to provide a set of functions that allows for users to easily get access to AFL data from sources such as [AFLtables](https://afltables.com) and [Footywire](https://www.footywire.com). There are also tools for processing and cleaning that data. Future versions will include basic ELO processing functions. 


## Load packages
First we need to grab a few packages. If you don't have any of these, you'll need to install them. 

```{r load_packages, eval=eval_param, message=FALSE, warning=FALSE}
library(dplyr)
library(elo)
library(lubridate)
library(fitzRoy)
```

### Getting Data
Primarily, `fitzRoy` can be used to access data from various sources using the `fetch_` functions. For a detailed view on how the API works - view the `main fetch functions` vignette. 

### Match Results
You can access AFL match results data from various sources. The most complete is the afltables.com data, which includes all matches from 1897-current. 

```{r results, eval=FALSE}
results <- fetch_match_results_afltables()
```
```{r results2, eval=eval_param}
tail(results)
```

While it is possible to return all historical data, it is usually good practice to only return a small amount of data - such as a single season or round - and keep your own offline database of historical data. 

```{r}
results <- fetch_match_results_afltables(2020)

```

You can get results data from other sources including `AFL`, `Squiggle` and `Footywire`. The default source for `fetch_results()` is AFL.com.au. 

```{r results-all, eval=FALSE}
results_afl <- fetch_results(2020)
results_squiggle <- fetch_results_squiggle(2020)
results_footywire <- fetch_results_footywire(2020)
```


### Fixtures
You can access the fixture using the `fetch_fixture` function. This will produce a fixture from AFL.com.au by default. If no season is provided, the current calendar year will be returned. 

```{r fixture, eval=FALSE}
fixture <- fetch_fixture()
```
```{r fixture2, eval=eval_param}
head(fixture)
```

You can return historical or future fixtures (if available) by specifying the relevent season. You can also return specific rounds with the `round_number` argumenent. Other sources available include Squiggle and Footywire. 

```{r}
fetch_fixture(2020)
fetch_fixture(2021, round_number = 1)
fetch_fixture(2021, round_number = 1, source = "squiggle")
fetch_fixture_footywire(2021, round_number = 1)

```

### Ladder

You can recreate the ladder for every round of the home and away season since 1897. You can either pass in a dataframe extracted using `get_match_results` (ideal as `get_match_results` doesn't need to be executed every time `return_ladder` is called): 

```{r ladder1, message=FALSE, warning=FALSE, eval=FALSE}
ladder <- return_ladder(match_results_df = results)
```
```{r ladder2, message=FALSE, warning=FALSE, eval=eval_par.am}
head(ladder)
```

Or leave the `match_results_df` argument blank (which will execute the `get_match_results()` function internally):

```{r ladder3, message=FALSE, warning=FALSE, eval=FALSE}
ladder <- return_ladder()
```

Alternatively, we can also return the ladder for any round, or any season, or a combination of both round and season:

```{r ladder4, message=FALSE, warning=FALSE, eval=FALSE}
ladder_round <- return_ladder(match_results_df = results, season_round = 15, season = 2018)
```
```{r ladder5, message=FALSE, warning=FALSE, eval=eval_param}
head(ladder_round)
```
### Player Stats


### AFL Tables player results
A new function will return all detailed player stats from [AFLtables](https://afltables.com). Primarily, the easiest way to use this is simply to call `get_afltables_stats` with your required `start_date` and `end_date`.

```{r afltables_match, eval=FALSE}
stats <- get_afltables_stats(start_date = "2018-01-01", end_date = "2018-06-01")
```

```{r afltables_match2, eval=eval_param}
tail(stats)
```

We can also use the `update_footywire_stats` function to get the most up to date data. This will merge data from 2010-current with any new data points. 

```{r update_footywire, eval=FALSE, include=TRUE}
## Update footywire data
dat <- update_footywire_stats()
```



### Squiggle Data
You can access data from the [Squiggle API](https://api.squiggle.com.au) where the tips of well known AFL tipping models are collected. See full instructions on the above link. 

```{r squiggle_sources1, message=FALSE, warning=FALSE, eval=FALSE}
# You can get the sources
sources <- get_squiggle_data("sources")
```
```{r squiggle_sources2, message=FALSE, warning=FALSE, eval=eval_param}
head(sources)
```

```{r squiggle_tips1, message=FALSE, warning=FALSE, eval=FALSE}
# Get all tips
tips <- get_squiggle_data("tips")
```
```{r squiggle_tips2, message=FALSE, warning=FALSE, eval=eval_param}
head(tips)  
```

```{r squiggle_round1, message=FALSE, warning=FALSE, eval=FALSE}
# Get` just tips from round 1, 2018
tips_round <- get_squiggle_data("tips", round = 1, year = 2018)
```
```{r squiggle_round2, message=FALSE, warning=FALSE, eval=eval_param}
head(tips_round)
```



---
```{r reset-options, message=FALSE, warning=FALSE, include=FALSE}
options(original_options)
```
